
Voir DROPBOX/Organisation/CR.txt

- balise mention
  signaler une personne présente (voir pex 5495, Manuel de la Torre)

-> bug droits (6 nov 2019)
  depuis changement accès 338ec04 dans config.php, seul un admin peut éditer le xml, je comprends pas pourquoi

-> export
   -> relation dans les deux sens
   - virer les accents (idéalement, option pour les garder)
   + à partir d'un ensemble d'actes / de personnes
     -> faire la fonctionnalité
     - formulaire simple pour commencer
     - créer des collections (table collections)

-> erreurs (ponctuelles ?)
  -> pourquoi Basabilvaso apparaît dans l'acte 4789 ??
    (11 déc 2019, le prochain reset base va sans doute régler ça)
  - GREGORIO (de las Heras et de Espinoza)
  - Jose Manuel de ALTOLAGUIRRE
  (JOSE à virer du nom : fusion mal passée ?)
  - acte 4968 : la mère de l'épouse (Juana Belgrano !!) est sortie de la balise et les prénoms de l'épouse  sont incorrectement balisés
  - acte 8987 : acte caché, à extraire et créer + baliser 8987 (Gutierrez, Aguero, Dominga Gonzalez)
  - acte 7040 : acte caché, à extraire, créer et baliser (Belgrano)
  - acte 5911 : pourquoi le père de l'époux a un id mais n'est pas balisé ??
  - Ventura n'est pas un prénom (Juana, 13181)
  - FUSION : Maria Mercedes Sarratea 152, 683

-> recherche
  - sur plain text (pour baliser), avec liste d'actes comme la table
  - contenu

-> édition xml
  - attributs

-> edition nom d'une personne
  (facile maintenant, avec renomme_personne, qui est pour le moment dans fusion mais je vais le déplacer,
  faut juste ajouter une page minimaliste pour l'appeler)

+ Collections
  - table collections
  - page collections
  - page collection
  - création / suppression d'une collection
  - ajout d'une personne / d'un acte à une collection
  - suppression d'un élément à une collection

+ BUG fusion
    -> voir CR.txt 17 oct 2018 et commentaires dans fusion.php
    x exploration [|45]
    x découper html_fusion  [1h+|2h45]
      x code découpé [2h]
      x renommé html_fusion en html_preview_fusion
      x debug syntaxe [25]
      x test : prénoms et noms s'affichent pas (fixed) [20]

      -> séparer html, recherche ajax, et appel à fusion

    + exploration : comment est validé le formulaire preview ?!
    + réécrire proprement la fonction fusion
      + mettre à jour tout ce qui contient $personne_throw->id
        x table conditions  [|1h35]
        x table relations [|2h]
        x planning  [|5]
        x chgt ordre throw keep [|20]
        x table actes [|10]
        + changer le nom de $personne_keep  [|45]
          x explore   [|35]
          x code  [|10]
        x lisibilité  [|5]
        + update contenu de tous les actes rencontrés [|20+]
          x review code fusion_update_contenu_acte  [|20]
          x découpage [|15]
          x recenser actes  [|10]
          x fonction pour un acte [|1h]
          + tester en xml [|3h45]
            x ressortir test.php  [|10]
            x divers fixes [|1h10]
            x debuguer la fonction  [|45]
            x tests à la con affichage xml  [|1h]

      - tester actes bidons
        x bricolages/actes-bidons.xml uploadé [|10]
        x https://buenosaires.telecom-paristech.fr/fusion?personne-A=15261&personne-B=15267
        x fix syntaxe [|30]
        x fix renommage + delete personne   [|40]
        x fix update contenu  [|1h20]
        + recharger deux actes bidons
          x debug erreur sur mon fichier xml !! [|1h15]
            -> modifier le système de logs et d'alerte !
          x divers fixes  [|45]
            x fusion 16 14 (14)
            x fusion 12 8 (12)

      + supprimer_acte  [|5h]
        x conditions, relations, acte [|2h]
        x purge_personnes
        x Personne->remove_from_db()  [|1h]
          (au lieu de Database->delete_personne())
        x tests + debug [|2h]

      + refaire tests actes bidons (deux fusions en cascade pour vérifier)  [30]
        x F 3 7 (7)
        + Encore un bug : acte 1 perd relations de 3 (7)
        x F t4 t8 (8) -> ok
        x F t14 t8 (8) ok
        x F t8 p10 (10) ok
        x F e12 m17 (12)
      x (re)supprimer actes bidons  [4]
      x remettre la valeur max de la base [7]
      x sauvegarde xml : ok, diff vide  [10]
      + tester plein de vrais cas
       (il faudra réinitialiser après)
        + pb sur acte 4730
          x F Belgrano 404 + 514
            -> manque condition Don sur acte 4730
            (mais 404 l'avait déjà sur d'autres)
          x suppression acte 4730
            -> epoux non supprimés, reste condition Don
          x conditions supprimées à la main
            (pas testé suppression des personnes après)
          x acte réimporté
          x Maria Mercedes Sarratea 152, 683 (152)
            ok (y compris le Don, passé de 683 à 152,
            mais il n'était pas sur le 152)

      - reset base (voir CR général, 6 déc 2019)

      + nettoyer *mon* code
        - supprimer les fonctione obsolètes
        - remonter liste des balises personnes
          (de fusion/change_id_personne_xml vers XMLActeReader)
        - renommer + déplacer les fonctions qui peuvent l'être

    NB : pour les tests, utiliser les url get :
    https://buenosaires.telecom-paristech.fr/fusion?personne-A=383&personne-B=419


    - afficher une erreur sur un des deux ids n'existe pas (quand on arrive par url)

+ admin
    -> changer Log et Alerte pour qu'ils affichent tout de suite plutôt que d'enregistrer pour plus tard
    - fonction réinitialiser le mot de passe
    -> problème de chmod à la création de compte

+ dates
    - empêcher les dates fantaisistes, en mettant null ou un truc comme ça

+ détails personne
    - vérifier date fantaisiste pour la période (voir todo dates)

+ code
    - optimiser l'export : Database->get_personnes
      (peut-être mettre dans select des trucs de from_db)
    - dispatcher io/Database.php/from_db() en méthode de chaque classe
    - factoriser html_personne_relations, voire dispatcher dans Personne
    - virer Personne->relations pour le remplacer complètement par _by_type
    - fermer les connexions à la base (j'ai l'impression qu'elles le sont rarement)

+ édition du xml
    - glitch sur la flèche gauche (remonter) quand le mot est petit,
    l'infobulle vient par-dessus le bouton en clignotant, difficile de le choper
    - recherche des personnes par le nom pour choisir l'id

+ xmlselect
    -> comment ça se passe pour les attributs ??
    - pour chaque élément, proposer une liste de couples
      attribut / valeur prédéfinis (dans tag_set.js),
      p.ex { "don" : "true" } pour les personnes
      et pour les noms { "attr" : "de la" }, { "attr" : "de" }
      "de los" et "del" (je crois)
    - BUG : l'info-bulle de la flèche pour sortir un truc de la balise,
      empêche parfois de cliquer sur le bouton la deuxième fois
    - info-bulle : parler ptet de "sortir de la balise" plutôt que
      "remonter" (confusion possible avec monter d'un cran verticalement)

+ structure xml
    - mettre en cohérence dtd, saisie en js, import en php
    - balise relation à la main

+ export
    - gdf

+ import
    - vérifier ce qui se passe sur les noms (parfois ça doublonne)
    par ex Maria Mercedes Sarratea 152, 683)
    - supprimer les conditions ou relations si elles n'apparaissent pas dans l'acte (en cas de balisage erroné précédemment)
    - quand la date comporte une erreur (29 février par ex), tenter de sauver quelque chose (au moins l'année) plutôt que 00-00-0000

+ recherche
    -> BUG : toutes les personnes ne sortent pas (peut-être les noms trouvent en minuscule ?  Peut-être à la suite d'une dissoc ?).  Francisco Belgrano 383 et 419 (trouvés grâce à la recherche sur la page Dissoc)
    - input text en plus de la liste
    - possibilité de ne mettre que l'année
    - dans le résultat : faire apparaître explicitement le nom recherché

+ fusion
    -> pour la sélection des ids, faire en sorte que le formulaire puisse aussi marcher sans ajax
    - montrer le résultat à la fin (plutôt qu'une page vide)
    BUG : le nom s'affiche dans la liste des prénoms
    [sur quels cas ?]
    - confusion entre recherche et prévisualiser (désactiver le bouton
    tant qu'on n'a pas sélectionné deux)
    - dispact_actes pas clair pour conditions
    (voir fusion Belgrano 404 + 514 (404)
    Don de acte 4730 pas conservé)

+ classes
    - supprimer des entrées (relations, conditions, etc.)
    - éditer les champs depuis les pages
    - BUG : dans Acte->remove_from_db, les conditions ne sont pas supprimées correctement (dans acte_has oui, mais pas dans condition), du coup les personnes peuvent pas être supprimées (cf + haut Frutos, dans le commit courant)

+ modifs ponctuelles
    - Cristina
    - fusions Francisco Belgrano

+ base
    -> en-tête <?xml version="1.0"?> en trop sur actes
    modifiés (réglé pour nouvelle fusion au moment du asXML)
    - recharger actes balisés en 2016-2017 et perdus au reinit
      (voir bricolages/diff-others, cf diff_with_newlines dans
      session.sh)
      bon, je crois qu'y en a genre 8, j'ai fait le 1086
      ATTENTION aux ids nouveaux
    - dump pour Access

+ interne
    -> sauvegarder le fichier de log dans history quand atteint la
        limite (Log.php)

+ site
    - "mit" à jour
    BUG : menu s'affiche pas sur IE
